[https://habr.com/ru/company/developersoft/blog/302118/](https://habr.com/ru/company/developersoft/blog/302118/) - статья про иммутабельность

[https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex) - findIndex

[https://www.npmjs.com/package/uuid](https://www.npmjs.com/package/uuid) - uuid npm

[https://lodash.com/docs/4.17.15#uniqueId](https://lodash.com/docs/4.17.15#uniqueId) - uniqueld от lodash

[https://www.npmjs.com/package/react-id-generator](https://www.npmjs.com/package/react-id-generator) - react-id-generator

  

![[Untitled 23.png|Untitled 23.png]]

Что такое понятие **иммутабельности**?

Мы уже знаем, что напрямую **state** изменять нельзя. Для его изменения мы используем **setState()**.

**Иммутабельным** **объект** называется тогда, когда он не может быть изменен после его создания.

Чтобы внести какие-то изменения, мы можем создать **копию** **объекта** с внесенными изменениями. Старый **объект** остается не измененным. Такой подход дает много плюсов.

  

В данном коде мы создаем функционал удаления и создание сотрудника.

- Удаление сотрудника

Мы создаем свое собственное **событие** **onDelete**, которое при клике на кнопку "корзина" по иерархии передается через **props**: **EmployeesListItem** ⇒ **EmployeesList** ⇒ **App**

В **компоненте** **App** наше собственное **событие** **onDelete** вызывает **метод** **deleteItem**.

В данном **методе** мы можем использовать 2 разных способа:

1. Мы создаем 4 **переменные**: **index**, **before**, **after**, **newArr**.
    
    > В **переменной** **index** - с помощью **метод** **findIndex()** сравнивается **id** каждого **объекта** с той **id**, которая пришла в виде **аргумента** и если совпадение нашлось, возвращает индекс того **объект**, где нашлось совпадение.
    
    > В **before** - с помощью метода **slice** с **0** элемента до того, который мы нашли, мы создаем **копию** **массива**.
    
    > В **after** - с помощью **метода** **slice** с элемента, который мы нашли(пропуская его) и до конца, мы создаем копию **массива**.
    
    > В **newArr** - с помощью **spred** **оператора** мы соединяем 2 предыдущих **массива** **before**, **after** и создаем **новый**.
    

И последнее вместо **data** мы возвращаем новый сформированный **newArr** **newArr**.

1. Используем **метод** **filter()**

  

- Создание сотрудника

В **компоненте** **EmployeesAddForm** при нажатии на кнопку "Добавить" срабатывает **метод** **onSubmit**, который:

> отменяет стандартное поведение браузера(стандартную перезагрузку страницы)

> далее вызывается наше собственное **событие** **onAdd**, которое по иерархии выше создается в **компоненте** **App** и передается как **props**. Это **событие** вызывает **метод** **addItem**, которое возвращает нам созданный новый **массив** вместе с новым сотрудником

> и с помощью команды **setState()** изменяем **состояния** и записываем **name**(имя) и **salary**(цену нового сотрудника)

app.js

```JavaScript
import { Component } from 'react';

import AppInfo from '../app-info/app-info';
import SearchPanel from '../search-panel/search-panel';
import AppFilter from '../app-filter/app-filter';
import EmployeesList from '../employees-list/employees-list';
import EmployeesAddForm from '../employees-add-form/employees-add-form';

import './app.css';

class App extends Component {
	constructor(props) {
		super(props);
		this.state = {
			data: [
				{name: 'John', salary: 300, increase: false, id: 1},
				{name: 'Jack', salary: 800, increase: true, id: 2},
				{name: 'James', salary: 900, increase: false, id: 3},
			]
		}
		this.maxId = 4;
	}
	
	deleteItem = (id) => {
		this.setState(({data}) => {
			// const index = data.findIndex(elem => elem.id === id);

			// const before = data.slice(0, index);
			// const after = data.slice(index + 1);

			// const newArr = [...before, ...after];
			// return {
			// 	data: newArr
			// }

			return {
				data: data.filter(item => item.id !== id)
			}
		})
	}

	addItem = (name, salary) => {
        const newItem = {
            name, 
            salary,
            increase: false,
            id: this.maxId++
        }
        this.setState(({data}) => {
            const newArr = [...data, newItem];
            return {
                data: newArr
            }
        });
    }

	render() {
		return (
			<div className="app">
				<AppInfo />
	
				<div className="search-panel">
					<SearchPanel/>
					<AppFilter/>
				</div>
				
				<EmployeesList 
					data={this.state.data}
					onDelete={this.deleteItem}/>
				<EmployeesAddForm onAdd={this.addItem}/>
			</div>
		)
	}
}

export default App;
```

employees-list.js

```JavaScript
import EmployeesListItem from "../employees-list-item/employees-list-item";

import './employees-list.css';

const EmployeesList = ({data, onDelete}) => {

    const elements = data.map(item => {
        const {id, ...itemProps} = item;
        return(
            <EmployeesListItem 
                key={id} 
                {...itemProps}
                onDelete={() => onDelete(id)}/>
        )
    })
    
    return (
        <ul className="app-list list-group">
            {elements}
        </ul>
    )
}

export default EmployeesList;
```

employees-list-item.js

```JavaScript
import { Component } from 'react';

import './employees-list-item.css';

class EmployeesListItem extends Component {
    constructor(props) {
        super(props);
        this.state = {
            increase: false,
            like: false
        }
    }

    onIncrease = () => {
        this.setState(({increase}) => ({
            increase: !increase
        }))
    }

    onLike = () => {
        this.setState(({like}) => ({
            like: !like
        }))
    }

    render() {
        const {name, salary, onDelete} = this.props;
        const {increase, like} = this.state;
        let classNames = "list-group-item d-flex justify-content-between";
        if (increase) {
            classNames += ' increase';
        } else if (like) {
            classNames += ' like';
        }
    
        return (
            <li className={classNames}>
                <span
                    className="list-group-item-label"
                    onClick={this.onLike}>
                {name}</span>
                <input type="text" className="list-group-item-input" defaultValue={salary + '$'}/>
                <div className='d-flex justify-content-center align-items-center'>
                    <button type="button"
                        className="btn-cookie btn-sm"
                        onClick={this.onIncrease}>
                        <i className="fas fa-cookie"></i>
                    </button>
    
                    <button type="button"
                            className="btn-trash btn-sm "
                            onClick={onDelete}>
                        <i className="fas fa-trash"></i>
                    </button>
                    <i className="fas fa-star"></i>
                </div>
            </li>
        )
    }

}

export default EmployeesListItem;
```

employees-add-form.js

```JavaScript
import { Component } from 'react';

import './employees-add-form.css';

class EmployeesAddForm extends Component {
    constructor(props) {
        super(props);
        this.state = {
            name: '',
            salary: ''
        }
    }

    onValueChange = (e) => {
        this.setState({
            [e.target.name] : e.target.value
        })
    }

    onSubmit = (e) => {
        e.preventDefault();
        this.props.onAdd(this.state.name, this.state.salary);
        this.setState({
            name: '',
            salary: ''
        })
    }

    render() {
        const {name, salary} = this.state;

        return (
            <div className="app-add-form">
                <h3>Добавьте нового сотрудника</h3>
                <form
                    className="add-form d-flex"
                    onSubmit = {this.onSubmit}>
                    <input type="text"
                        className="form-control new-post-label"
                        placeholder="Как его зовут?"
                        name="name"
                        value={name} 
                        onChange={this.onValueChange}/>
                    <input type="number"
                        className="form-control new-post-label"
                        placeholder="З/П в $?"
                        name="salary"
                        value={salary} 
                        onChange={this.onValueChange}/>
    
                    <button type="submit"
                            className="btn btn-outline-light">Добавить</button>
                </form>
            </div>
        )
    }
}

export default EmployeesAddForm;
```