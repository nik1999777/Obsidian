- Что такое Docker, преимущества**,** основные термины.
    
    **Docker** — это инструмент для автоматизации развертывания приложений в контейнерах. Контейнеры обеспечивают изоляцию приложений и их зависимостей от остальной системы.
    
    **Преимущества Docker**
    
    1. **Портативность**: Приложения в контейнерах могут работать на любой системе с установленным Docker.
    2. **Изоляция**: Контейнеры изолируют приложения и их зависимости, что устраняет конфликты версий.
    3. **Эффективность**: Контейнеры используют ресурсы более эффективно по сравнению с виртуальными машинами.
    4. **Быстрое развертывание**: Упрощает и ускоряет процесс развертывания приложений.
    
    **Основные термины Docker**
    
    1. **Образы (Images)**: Это шаблоны, которые содержат все необходимое для запуска приложения, включая код, зависимости, и настройки среды. Образы служат основой для создания контейнеров.
    2. **Контейнеры (Containers)**: Это запущенные экземпляры образов. Контейнеры изолируют приложение и его окружение, обеспечивая стабильную работу независимо от среды, в которой они выполняются.
    3. **Docker Daemon**: Фоновый процесс, который управляет созданием, запуском и мониторингом контейнеров. Docker Daemon отвечает за все операции с Docker.
    4. **Docker Client**: Интерфейс командной строки, который позволяет пользователю взаимодействовать с Docker Daemon. Команды, вводимые через Docker Client, направляются к Docker Daemon для выполнения.
    5. **Docker Hub**: Онлайн-реестр, где хранятся образы Docker. Это центральное место для поиска и скачивания готовых образов, а также для публикации собственных.
    6. **Dockerfile**: Текстовый файл с инструкциями для создания образа. В Dockerfile указываются команды для настройки среды и установки зависимостей, необходимых для запуска приложения.
    7. **Docker Compose**: Инструмент для определения и управления многоконтейнерными приложениями. Файл docker-compose.yml описывает услуги (сервисы), их зависимости и способы их взаимодействия.
- Основные команды Docker.
    - **docker run**: Запуск контейнера из образа.
    - **docker ps**: Список запущенных контейнеров.
    - **docker build**: Создание образа из Dockerfile.
    - **docker pull**: Загрузка образа из реестра.
    - **docker push**: Отправка образа в реестр.
    - **docker-compose up**: Запуск всех сервисов, определенных в docker-compose.yml.
    - **docker-compose down**: Остановка и удаление всех контейнеров, созданных с помощью docker-compose.
- Dockerfile
    
    Dockerfile — это текстовый файл с инструкциями для создания Docker-образа. Каждая инструкция в Dockerfile создает новый слой в образе, и эти слои кэшируются для ускорения повторных сборок.
    
    ---
    
    **Основные инструкции Dockerfile:**
    
    ---
    
    1. **FROM**:
        
        - Указывает базовый образ для сборки нового образа.
        - Пример:
        
        ```Docker
        FROM alpine:3.14
        ```
        
    2. **RUN**:
        
        - Выполняет команды внутри контейнера при создании образа. Обычно используется для установки пакетов или выполнения скриптов.
        - Пример:
        
        ```Docker
        RUN apk add --no-cache python3 py3-pip
        ```
        
    3. **COPY и ADD**:
        
        - COPY копирует файлы и директории из контекста сборки в файловую систему контейнера.
        - ADD делает то же самое, но также может извлекать архивы и копировать файлы из URL.
        - Пример:
        
        ```Docker
        COPY . /app
        ```
        
    4. **CMD и ENTRYPOINT**:
        
        - Указывают команду, которая будет выполнена при запуске контейнера.
        - CMD задает команду по умолчанию, которую можно переопределить при запуске контейнера.
        - ENTRYPOINT задает неизменяемую команду.
        - Пример:
        
        ```Docker
        CMD ["python3", "app.py"]
        ```
        
    5. **EXPOSE:**
        
        - Указывает, какие порты будут доступны для внешнего мира.
        - Пример:
        
        ```Docker
        EXPOSE 8080
        ```
        
    6. **ENV:**
        
        - Устанавливает переменные окружения.
        - Пример:
        
        ```Docker
        ENV APP_ENV=production
        ```
        
    7. **WORKDIR:**
        
        - Задает рабочую директорию для выполнения команд.
        - Пример:
        
        ```Docker
        WORKDIR /app
        ```
        
        **Пример Dockerfile**
        
        Ниже приведен пример Dockerfile для простого веб-приложения на Node.js:
        
        ```Docker
        # Указываем базовый образ
        FROM node:14
        
        # Устанавливаем рабочую директорию
        WORKDIR /app
        
        # Копируем файл package.json и устанавливаем зависимости
        COPY package.json /app
        RUN npm install
        
        # Копируем все файлы в рабочую директорию
        COPY . /app
        
        # Открываем порт для приложения
        EXPOSE 3000
        
        # Указываем команду для запуска приложения
        CMD ["node", "server.js"]
        ```
        
        ---
        
        **Оптимизация Dockerfile**
        
        1. **Минимизация количества слоев**
        
        Каждая инструкция RUN, COPY, и ADD в Dockerfile создает новый слой в образе. Для уменьшения размера образа и повышения эффективности сборки следует объединять команды в одну инструкцию RUN.
        
        **Пример:**
        
        Вместо этого:
        
        ```Docker
        
        RUN apt-get update
        RUN apt-get install -y curl
        RUN apt-get install -y vim
        RUN rm -rf /var/lib/apt/lists/*
        ```
        
        Используйте это:
        
        ```Docker
        
        RUN apt-get update && apt-get install -y \
            curl \
            vim \
            && rm -rf /var/lib/apt/lists/*
        ```
        
        1. **Использование минимальных базовых образов**
        
        Минимальные базовые образы, такие как alpine, значительно уменьшают размер конечного образа.
        
        **Пример:**
        
        Вместо этого:
        
        ```Docker
        FROM ubuntu:20.04
        ```
        
        Используйте это:
        
        ```Docker
        FROM alpine:3.14
        ```
        
        1. **Очистка кэша и временных файлов**
        
        Удаляйте кэш и временные файлы после установки пакетов, чтобы уменьшить размер образа.
        
        **Пример:**
        
        ```Docker
        RUN apk add --no-cache python3 py3-pip \
            && rm -rf /var/cache/apk/*
        ```
        
        1. **Использование .dockerignore файла**
        
        Создайте файл .dockerignore в корневой директории проекта, чтобы исключить из контекста сборки ненужные файлы и директории. Это уменьшит размер контекста сборки и ускорит процесс.
        
        **Пример .dockerignore:**
        
        ```Docker
        node_modules
        .git
        tmp
        *.md
        ```
        
        5. **Уменьшение количества копируемых файлов**
        
        Копируйте только необходимые файлы для сборки и выполнения приложения.
        
        **Пример:**
        
        Вместо этого:
        
        ```Docker
        COPY . /app
        ```
        
        Используйте это:
        
        ```Docker
        COPY package.json /app
        COPY src /app/src
        COPY public /app/public
        ```
        
        1. **Использование многоканальной сборки (multi-stage builds)**
        
        Многоканальная сборка позволяет создавать небольшие и оптимизированные конечные образы, отделяя процесс сборки от финального образа.
        
        **Пример:**
        
        ```Docker
        # Этап сборки
        FROM node:14 as build
        WORKDIR /app
        COPY package.json /app
        RUN npm install
        COPY . /app
        RUN npm run build
        
        # Финальный этап
        FROM nginx:alpine
        COPY --from=build /app/build /usr/share/nginx/html
        ```
        
        В этом примере первый этап собирает приложение, а второй этап создает финальный образ, содержащий только результат сборки.
        
        ---
        
        Dockerfile используется для автоматизации создания Docker-образов, позволяя задавать базовые образы, устанавливать зависимости и определять команды для запуска контейнеров.
        
- Docker Images.
    
    **Структура образов: слои образа, как они создаются и хранятся**
    
    Docker образы состоят из множества слоев. Каждый слой представляет собой одно изменение в файловой системе, например, установку пакета или копирование файла. Слои образов создаются при выполнении инструкций в Dockerfile.
    
    - **Базовый слой**: Это первый слой образа, который обычно указывается с помощью инструкции FROM в Dockerfile.
    - **Промежуточные слои**: Создаются при выполнении инструкций RUN, COPY, ADD и других в Dockerfile. Каждый промежуточный слой хранит изменения, сделанные в образе.
    - **Кэширование слоев**: Docker использует кэширование для повторного использования слоев, чтобы ускорить сборку образов. Если инструкция не изменилась, Docker возьмет кэшированный слой.
    - **Хранение слоев**: Все слои хранятся в файловой системе Docker на хосте. Docker использует объединенную файловую систему для объединения всех слоев в единое файловое пространство, доступное контейнерам.
    
    ---
    
    **Создание минимальных образов**
    
    Создание минимальных образов помогает уменьшить размер образов и повысить безопасность и эффективность.
    
    Основные принципы:
    
    - **Использование минимальных базовых образов**: Например, alpine вместо более крупных образов, таких как ubuntu или debian.
    - **Удаление временных файлов**: Очистка кэша и удаление временных файлов после установки пакетов.
    - **Минимизация количества слоев**: Комбинирование команд в Dockerfile для уменьшения количества промежуточных слоев.
    
    ---
    
    **Примеры популярных образов: alpine, nginx, node, и их использование**
    
    ==**alpine**====:==
    
    - **Контекст**: Alpine используется как базовый образ для создания легковесных контейнеров. Этот образ подходит для проектов, где важны минимальные размеры и безопасность.
    - **Проекты**:
        - **Микросервисы**: Alpine подходит для создания микросервисов, где каждый контейнер выполняет небольшую функцию.
        - **Скрипты и утилиты**: Легковесные контейнеры для выполнения различных скриптов и утилит, например, скриптов для автоматизации задач.
    
    Пример:
    
    ```Docker
    FROM alpine:3.14
    RUN apk add --no-cache curl
    CMD ["curl", "--version"]
    ```
    
    Этот Dockerfile создает контейнер, который содержит утилиту curl, и его можно использовать для выполнения HTTP-запросов в скриптах и автоматизированных процессах.
    
    ==**nginx**====:==
    
    - **Контекст**: Nginx используется как веб-сервер и обратный прокси-сервер. Этот образ идеально подходит для проектов, где требуется развернуть веб-сайт или веб-приложение.
    - **Проекты**:
        - **Статические веб-сайты**: Размещение статических файлов, таких как HTML, CSS, и JavaScript.
        - **Обратный прокси**: Прокси-сервер для маршрутизации запросов к различным внутренним сервисам.
    
    Пример проекта:
    
    ```Docker
    FROM nginx:latest
    COPY ./my-site /usr/share/nginx/html
    ```
    
    Этот Dockerfile копирует содержимое папки my-site в директорию веб-документов Nginx, что позволяет развернуть статический веб-сайт.
    
    ==**node**====:==
    
    - **Контекст**: Node.js образ используется для разработки и запуска серверных JavaScript-приложений. Этот образ необходим для проектов, где требуются серверные приложения на JavaScript.
    - **Проекты**:
        - **Веб-приложения**: Разработка и развертывание серверной части веб-приложений.
        - **API-сервисы**: Создание RESTful или GraphQL API.
    
    Пример проекта:
    
    ```Docker
    FROM node:14
    WORKDIR /app
    COPY package.json /app
    RUN npm install
    COPY . /app
    CMD ["node", "server.js"]
    ```
    
    Этот Dockerfile устанавливает зависимости Node.js, копирует исходный код и запускает серверное приложение. Он подходит для развертывания веб-сервисов и API на Node.js.