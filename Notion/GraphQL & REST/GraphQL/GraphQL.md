**Что же такое этот GraphQL?**

Если вы такой же, как и я, вы обычно проходите через три этапа, когда узнаёте о новой технологии:

- Отрицание: _Ещё одна JavaScript библиотека?! Зачем? У меня уже есть jQuery!_
- Интерес: _Хм, наверное мне_ _**следует**_ _взглянуть на эту библиотеку..._
- Паника: _Помогите! Мне нужно изучить эту библиотеку_ _**прямо сейчас**__, иначе мои знания устареют!_

Есть одна хитрость для поддержания благоразумия в эпоху быстроразвивающихся технологий: изучать новые вещи между вторым и третьим этапом, как только интерес задет, но пока технология ещё не распространена повсеместно.

Именно поэтому сейчас самое время узнать, что же такое этот GraphQL, о котором вы повсюду слышите.

# **Основы**

В двух словах, GraphQL это **синтаксис, который описывает как запрашивать данные**, и, в основном, используется клиентом для загрузки данных с сервера. GraphQL имеет три основные характеристики:

- Позволяет клиенту точно указать, какие данные ему нужны.
- Облегчает агрегацию данных из нескольких источников.
- Использует систему типов для описания данных.

Так с чего же начать изучение GraphQL? Как это выглядит на практике? Как начать его использовать? Читайте дальше чтобы узнать!

![[Untitled 77.png|Untitled 77.png]]

# **Задача**

GraphQL был разработан в большом старом Facebook, но даже гораздо более простые приложения могут столкнуться с ограничениями традиционных REST API интерфейсов.

Например представьте, что вам нужно отобразить список `записей` (`posts`), и под каждым опубликовать список `лайков` (`likes`), включая имена пользователей и аватары. На самом деле, это не сложно, вы просто измените API `posts` так, чтобы оно содержало массив `likes`, в котором будут объекты-пользователи.

![[Untitled 1 24.png|Untitled 1 24.png]]

Но затем, при разработке мобильного приложения, оказалось что из-за загрузки дополнительных данных приложение работает медленнее. Так что вам теперь нужно _два_ endpoint, один возвращающий записи с лайками, а другой без них.

Добавим ещё один фактор: оказывается, записи хранятся в базе данных MySQL, а лайки в Redis! Что же теперь делать?!

Экстраполируйте этот сценарий на то множество источников данных и клиентских API, с которыми имеет дело Facebook, и вы поймёте почему старый добрый REST API достиг своего предела.

# **Решение**

Facebook придумал концептуально простое решение: вместо того, чтобы иметь множество "глупых" endpoint, лучше иметь один "умный" endpoint, который будет способен работать со сложными запросами и придавать данным такую форму, какую запрашивает клиент.

Фактически, слой GraphQL находится между клиентом и одним или несколькими источниками данных; он принимает запросы клиентов и возвращает необходимые данные в соответствии с переданными инструкциями. Запутаны? Время метафор!

Пользоваться старой REST-моделью это как заказывать пиццу, затем заказывать доставку продуктов, а затем звонить в химчистку, чтобы забрать одежду. Три магазина – три телефонных звонка.

![[Untitled 2 17.png|Untitled 2 17.png]]

GraphQL похож на личного помощника: вы можете передать ему адреса всех трех мест, а затем просто запрашивать то, что вам нужно («принеси мне мою одежду, большую пиццу и два десятка яиц») и ждать их получения.

![[Untitled 3 7.png|Untitled 3 7.png]]

Другими словами, GraphQL это стандартный язык для разговора с этим волшебным личным помощником.

![[Untitled 4 4.png|Untitled 4 4.png]]

_Согласно Google Images, типичный личный помощник это пришелец с восемью руками_

![[Untitled 5 3.png|Untitled 5 3.png]]

На практике GraphQL API построен на трёх основных строительных блоках: на **схеме** (schema), **запросах** (queries) и **распознавателях** (resolvers).

## **Запросы (queries)**

_(query и request одинаково переводится как "запрос". Далее будет подразумеваться query, если не указано иначе – прим. пер.)_

Когда вы о чём-то просите вашего персонального помощника, вы выполняете **запрос**. Это выглядит примерно так:

```GraphQL
query {
  stuff
}
```

Мы объявляем новый запрос при помощи ключевого слова `query`, также спрашивая про поле `stuff`. Самое замечательное в запросах GraphQL является то, что они поддерживают вложенные поля, так что мы можем пойти на один уровень глубже:

```GraphQL
query {
  stuff {
    eggs
    shirt
    pizza
  }
}
```

Как можно заметить, клиенту при формировании запроса не нужно знать откуда поступают данные. Он просто спрашивает о них, а сервер GraphQL заботится об остальном.

Также стоит отметить, что поля запроса могут быть **массивами**. Например вот общий шаблон запроса списка сообщений:

```GraphQL
query {
  posts { # это массив
    title
    body
    author { # мы может пойти глубже
      name
      avatarUrl
      profileUrl
    }
  }
}
```

Поля запроса также могут содержать аргументы. Например, если необходимо отобразить конкретный пост, можно добавить аргумент `id`к полю `post`:

```GraphQL
query {
  post(id: "123foo"){
    title
    body
    author{
      name
      avatarUrl
      profileUrl
    }
  }
}
```

Наконец, если нужно сделать аргумент `id`динамическим, можно определить **переменную**, а затем использовать её в запросе (обратите внимание, также мы сделали запрос **именованным**):

```GraphQL
query getMyPost($id: String) {
  post(id: $id){
    title
    body
    author{
      name
      avatarUrl
      profileUrl
    }
  }
}
```

Хороший способ попробовать все это на практике – использовать [GraphQL API Explorer](https://developer.github.com/early-access/graphql/explorer/) от GitHub. Например, давайте попробуем выполнить следующий запрос:

```GraphQL
query {
  repository(owner: "graphql", name: "graphql-js"){
    name
    description
  }
}
```

![[Untitled 6 3.png|Untitled 6 3.png]]

Обратите внимание, когда вы вводите имя поля, IDE автоматически предлагает вам возможные имена полей, полученные при помощи GraphQL API. Ловко!

![[Untitled 7 3.png|Untitled 7 3.png]]

[_Анатомия запросов GraphQL (англ)_](https://dev-blog.apollodata.com/the-anatomy-of-a-graphql-query-6dffa9e9e747)

Вы можете узнать больше о запросах GraphQL в отличной статье ["Анатомия запросов GraphQL"](https://dev-blog.apollodata.com/the-anatomy-of-a-graphql-query-6dffa9e9e747) [_(англ)_](https://dev-blog.apollodata.com/the-anatomy-of-a-graphql-query-6dffa9e9e747)

## **Распознаватели (resolvers)**

Даже самый лучший в мире личный помощник не сможет принести ваши вещи из химчистки если вы не дадите ему адрес.

Подобным образом, сервер GraphQL не может знать что делать с входящим запросом, если ему не объяснить при помощи **распознавателя** (**resolver**).

Используя распознаватель GraphQL понимает, как и где получить данные, соответствующие запрашиваемому полю. К примеру, распознаватель для поля **запись** может выглядеть вот так (используя генератор схемы (schema) из набора Apollo [GraphQL-Tools](https://github.com/apollographql/graphql-tools)):

```GraphQL
Query: {
  post(root, args) {
    return Posts.find({ id: args.id });
  }
}
```

Мы помещаем наш распознаватель в раздел `Query`потому что мы хотим получать `запись` (`post`) в корне ответа. Но также мы можем создать распознаватели для подполей, как например для поля `author`:

```GraphQL
Query: {
  post(root, args) {
    return Posts.find({ id: args.id });
  }
},
Post: {
  author(post) {
    return Users.find({ id: post.authorId})
  }
}
```

Обратите внимание что ваши распознаватели не ограничены в количестве возвращаемых объектов. К примеру, вы захотите добавить поле `commentsCount`к объекту `Post`:

```GraphQL
Post: {
  author(post) {
    return Users.find({ id: post.authorId})
  },
  commentsCount(post) {
    return Comments.find({ postId: post.id}).count()
  }
}
```

Ключевое понятие здесь то, что **схема запроса GraphQL и структура вашей базы данных никак не связаны**. Другими словами, в базе данных может не существовать полей `author` или `commentsCount`, но мы можем "симулировать" их благодаря силе распознавателей.

Как было показано выше, вы можете писать любой код внутри распознавателя. Так что вы можете _изменять_ содержимое базы данных; такие распознаватели называют **изменяющими** (**mutation**).

## **Схема (schema)**

Все это становится возможным благодаря типизированной схеме данных GraphQL. Цель этой статьи дать скорее краткий обзор, чем исчерпывающее введение, так что в этом разделе не будет подробностей.

Я призываю вас заглянуть в [документацию GraphQL](http://graphql.org/learn/schema/) [_(англ)_](http://graphql.org/learn/schema/), если вы хотите узнать больше.

![[Untitled 8 3.png|Untitled 8 3.png]]

  

**Часто задаваемые вопросы:**

### **Что общего у GraphQL и** [**графовых баз данных**](https://ru.wikipedia.org/wiki/%D0%93%D1%80%D0%B0%D1%84%D0%BE%D0%B2%D0%B0%D1%8F_%D0%B1%D0%B0%D0%B7%D0%B0_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)**?**

Ничего общего. На самом деле, GraphQL не имеет ничего общего с графовыми БД типа [Neo4j](https://ru.wikipedia.org/wiki/Neo4j). Часть "Graph" отражает идею получения контента, проходя сквозь граф API, используя поля и подполя; часть "QL" расшифровывается как "query language" – "язык запросов".

### **Меня полностью устраивает REST, зачем мне переходить на GraphQL?**

Если вы не достигли болевых точек REST API, решением которых является GraphQL, то можете не волноваться.

Использование GraphQL поверх REST вероятнее всего не заставит вас производить какие-то сложные изменения в остальном API и ломать накопившийся пользовательский опыт, так что переход не будет вопросом жизни и смерти в любом случае. Так что определенно стоит попробовать GraphQL в небольшой части проекта, если это возможно.

### **Могу ли я использовать GraphQL без React/Relay/имя_библиотеки?**

Конечно! GraphQL это только спецификация, вы можете использовать его с любой библиотекой на любой платформе, используя готовый клиент (к примеру, у [Apollo](http://dev.apollodata.com/) есть клиенты для web, iOS, Angular и другие) или вручную отправляя запросы на сервер GraphQL.

### **GraphQL был создан Facebook, а я не доверяю Facebook.**

Ещё раз, GraphQL является всего лишь спецификацией, это значит что вы можете использовать его не используя ни одной строки кода, написанной Facebook.

Наличие поддержки Facebook это безусловно хороший плюс для экосистемы GraphQL. Но на данный момент сообщество достаточно большое чтобы поддерживать GraphQL, даже если Facebook перестанет его использовать.

### **Как-то "позволить клиенту просить о тех данных, которые ему нужны" не выглядит безопасным**

Так как вы пишете свои распознаватели, вы можете разрешать любые проблемы безопасности на этом уровне.

К примеру, если вы позволите клиенту использовать параметр `limit` для указания количества документов, которые он запрашивает, вы скорее всего захотите контролировать это число для избежания атак типа "отказ в обслуживании" когда клиент будет запрашивать миллионы документов снова и снова.

### **Так что же нужно чтобы начать?**

На самом деле, необходимо всего два компонента чтобы начать:

- Сервер GraphQL для обработки запросов к API
- Клиент GraphQL, который будет подключаться к endpoint.

![[Untitled 9 3.png|Untitled 9 3.png]]

Теперь, когда вы понимаете как работает GraphQL, можно поговорить о главных игроках в этой области.

## **Серверы GraphQL**

Первое что вам нужно для работы, это сервер GraphQL. [Сам GraphQL](http://graphql.org/) это просто спецификация, так что двери открыты для конкурирующих реализаций.

### [**GraphQL-JS**](https://github.com/graphql/graphql-js) **(Node)**

Это ссылка на оригинальную реализацию спецификации GraphQL. Вы можете использовать её с [express-graphql](https://github.com/graphql/express-graphql) для [создания своего сервера API](http://graphql.org/graphql-js/running-an-express-graphql-server/) [_(англ)_](http://graphql.org/graphql-js/running-an-express-graphql-server/).

### [**GraphQL-Server**](http://dev.apollodata.com/tools/graphql-server/) **(Node)**

Команда [Apollo](http://apollostack.com/) имеет свою собственную реализацию GraphQL-сервера. Она ещё не настолько полна как оригинал, но очень хорошо документирована, хорошо поддерживается и быстро развивается.

### **Другие платформы**

На официальном сайте есть [список реализаций спецификации GraphQL для различных платформ](http://graphql.org/code/) (PHP, Ruby и другие).

## **Клиенты GraphQL**

Конечно вы можете работать с API GraphQL напрямую, но специальная клиентская библиотека определённо может сделать вашу жизнь проще.

### [**Relay**](https://facebook.github.io/relay/)

Relay это собственный инструментарий Facebook. Он создавался с учётом потребностей Facebook и может быть немного избыточным для большинства пользователей.

### [**Клиент Apollo**](http://www.apollodata.com/)

Быстро занял своё место новый участник в этой области — [Apollo](http://apollostack.com/). Типичный клиент состоит из двух частей:

- [Apollo-client](http://dev.apollodata.com/core/), позволяющий выполнять запросы GraphQL в браузере (также есть [расширение для DevTools](https://github.com/apollographql/apollo-client-devtools))
- Коннектор для frontend-фреймворка ([React-Apollo](http://dev.apollodata.com/react/), [Angular-Apollo](http://dev.apollodata.com/angular2/) и другие)

  

По умолчанию Apollo-client сохраняет данных используя [Redux](http://redux.js.org/), который сам является достаточно авторитетной библиотекой управления состоянием с богатой экосистемой.

![[Untitled 10 3.png|Untitled 10 3.png]]

_Расширение Apollo для Chrome DevTools_

## **Приложения с открытым исходным кодом**

Несмотря на то, что GraphQL это достаточно новая концепция, уже есть некоторые перспективные приложения с открытым исходным кодом, которые используют её.

### [**VulcanJS**](http://vulcanjs.org/)

[![](https://habrastorage.org/r/w1560/getpro/habr/post_images/8de/0f8/a2c/8de0f8a2c3219f41e2e03beaa67624ed.png)](https://habrastorage.org/r/w1560/getpro/habr/post_images/8de/0f8/a2c/8de0f8a2c3219f41e2e03beaa67624ed.png)

Я _(автор оригинальной статьи — прим. пер.)_ являюсь ведущим разработчиком [VulcanJS](http://vulcanjs.org/). Я создал его чтобы дать людям возможность попробовать силу стека React/GraphQL без необходимости писать много шаблонного кода. Вы можете воспринимать его как "Rails для современной web-экосистемы" потому что он позволяет создавать CRUD-приложения ([клон Instagram](https://www.youtube.com/watch?v=qibyA_ReqEQ) например) в течение нескольких часов.

### [**Gatsby**](https://www.gatsbyjs.org/docs/)

Gatsby это генератор статических сайтов для React, который начиная с [версии 1.0](https://www.gatsbyjs.org/docs/) также использует GraphQL. Несмотря на то, что это можно показаться странным сочетанием на первый взгляд, это на самом деле довольно мощная идея. В процессе сборки Gatsby может извлекать данные из нескольких GraphQL API, затем используя их для создания полностью статического клиентского React-приложения.

## **Другие инструменты для работы с GraphQL**

### [**GraphiQL**](https://github.com/graphql/graphiql)

GraphiQL это очень удобная браузерная IDE для создания и выполнения запросов к endpoint-ам GraphQL.

![[Untitled 11 3.png|Untitled 11 3.png]]

### [**DataLoader**](https://github.com/facebook/dataloader)

Из-за вложенной природы запросов GraphQL, один запрос может легко вызывать десятки обращений к базе данных. Для снижения нагрузки вы можете использовать инструменты кеширования наподобие разработанной Facebook библиотеке DataLoader.

### [**Create GraphQL Server**](https://blog.hichroma.com/create-graphql-server-instantly-scaffold-a-graphql-server-1ebad1e71840)

Create GraphQL Server это консольная программа, позволяющая легко и быстро сгенерировать сервер на базе Node, использующий базу данных Mongo.

### [**GraphQL-up**](https://www.graph.cool/graphql-up/)

Аналогично Create GraphQL Server, GraphQL-up позволяет быстро создать GraphQL backend, но на базе сервиса [Graphcool](https://www.graph.cool/).

## **Сервисы GraphQL**

Наконец, есть целый ряд компаний, предоставляющих "GraphQL-backend-как-сервис"; они сами позаботятся о серверной части для вас, и это может быть хорошим способом окунуться в экосистему GraphQL.

### [**Graphcool**](http://graph.cool/)

Гибкая backend-платформа, объединяющая GraphQL и AWS Lambda, имеющая бесплатный тарифный план для разработки.

### [**Scaphold**](https://scaphold.io/)

Другой GraphQL-backend-как-сервис с бесплатным тарифным планом. Он предлагает много функций, подобных Graphcool.

![[Untitled 12 3.png|Untitled 12 3.png]]

Уже есть немало ресурсов по GraphQL.

_(Также предлагайте ресурсы на русском языке в комментариях – прим. пер.)_

### [**GraphQL.org**](http://graphql.org/learn/) [_**(англ)**_](http://graphql.org/learn/)

На официальном сайте GraphQL есть замечательная документация чтобы начать.

### [**LearnGraphQL**](https://learngraphql.com/) [_**(англ)**_](https://learngraphql.com/)

LearnGraphQL это интерактивный курс, созданный в компании [Kadira](https://kadira.io/).

### [**LearnApollo**](https://www.learnapollo.com/) [_**(англ)**_](https://www.learnapollo.com/)

Хорошее продолжение LearnGraphQL, LearnApollo это бесплатный курс, созданный [Graphcool](https://www.graph.cool/).

### [**Блог Apollo**](https://dev-blog.apollodata.com/) [_**(англ)**_](https://dev-blog.apollodata.com/)

Блог Apollo имеет массу подробных хорошо написанных постов о Apollo и GraphQL в целом.

### [**GraphQL Weekly**](https://graphqlweekly.com/) [_**(англ)**_](https://graphqlweekly.com/)

Информационная рассылка о GraphQL, курируемая командой Graphcool.

### [**Hashbang Weekly**](http://hashbangweekly.okgrow.com/) [_**(англ)**_](http://hashbangweekly.okgrow.com/)

Еще одна большая новостная рассылка, которая помимо GraphQL также охватывает React и Meteor.

### [**Freecom**](https://www.graph.cool/freecom/) [_**(англ)**_](https://www.graph.cool/freecom/)

Серия руководств, описывающая как создать клон Интерком с помощью GraphQL.

### [**Awesome GraphQL**](https://github.com/chentsulin/awesome-graphql) [_**(англ)**_](https://github.com/chentsulin/awesome-graphql)

Довольно исчерпывающий перечень ссылок и ресурсов по GraphQL.

![[Untitled 13 3.png|Untitled 13 3.png]]

Как же вы можете применить вновь приобретенные знания о GraphQL на практике? Вот несколько рецептов, которые можно попробовать:

### [**Apollo + Graphcool + Next.js**](https://github.com/zeit/next.js/tree/master/examples/with-apollo)

Если вы уже знакомы с Next.js и React, этот пример позволит вам настроить GraphQL endpoint при помощи Graphcool и затем отправлять ей запросы при помощи Apollo.

### [**VulcanJS**](http://docs.vulcanjs.org/)

[Учебник Vulcan](http://docs.vulcanjs.org/) [_(англ)_](http://docs.vulcanjs.org/) поможет вам создать простой слой данных GraphQL на сервере и на клиенте. Поскольку Vulcan является платформой "все-в-одном", это хороший способ начать работу без каких-либо настроек. Если вам нужна помощь, не стесняйтесь [обратиться в наш канал Slack](http://slack.vulcanjs.org/) [_(англ)_](http://slack.vulcanjs.org/)!

### [**Учебник GraphQL & React**](https://blog.hichroma.com/graphql-react-tutorial-part-1-6-d0691af25858#.o54ygcruh)

В блоге Chroma есть [руководство из шести частей](https://blog.hichroma.com/graphql-react-tutorial-part-1-6-d0691af25858#.o54ygcruh) [_(англ)_](https://blog.hichroma.com/graphql-react-tutorial-part-1-6-d0691af25858#.o54ygcruh) по созданию приложения React/GraphQL используя компоненто-ориентированный подход к разработке.

![[Untitled 14 3.png|Untitled 14 3.png]]

# **Заключение**

GraphQL поначалу может показаться сложным, потому что это технология, которая затрагивает многие области современной разработки. Но уделив время чтобы понять основные концепции, я думаю вы поймёте что многое из этого имеет смысл.

Решите ли вы использовать это или нет, я считаю что стоит потратить время чтобы ознакомиться с GraphQL. Все больше и больше компаний и структур начинают использовать его, и он вполне может в течение следующих нескольких лет стать одним из ключевых строительных блоков в веб-разработке.