В данном коде мы сначала получаем все **form** со страницы с помощью **метода** **querySelectorAll()**.

Создаем **объект** **message**, в котором у нас будут лежать текстовые сообщения о стадии отправки данных на **сервер**.

Далее в коде мы с помощью **метода** **перебора** **forEach()** подвязываем все **формы** на сайте к **функции** **postData()**

Далее создается **функция** **postData()**, которая будет отвечать за **постинг** данных. И внутри **функция** принимает в себе **аргумент** **form**. Это делается

потому что внутри **функции** нам очень удобно на этот **аргумент** **form** навесить **обработчик события** **form.addEventListener()**. Используем **событие** **submit** - оно срабатывает каждый раз, когда мы пытаемся отправить какую то **форму**. Отменяем стандартное поведение браузера - перезагрузку страницы с помощью **e.preventDefault()**.

Ну и после этого мы опять работаем с **объектом XMLHttpRequest()**. Мы помним, что сначала используем **метод open()**, чтобы настроить **запрос**. И следущая главная задача - это сделать так, чтобы все данные, который заполнил пользователь в форме мы получили в JS и уже могли отправить на **сервер**. Существует 2 формата передачи данных из **формы** - это **formData**, а второй это  **JSON**.

В данном случаем, мы создаем **объект** **new FormData(form)**, а внутри помещаем ту **форму** из которой нам нужно собрать данные.(Важно для верстальщиков: чтобы данный **формат передачи данных** работал нужно в **input** в **html** всегда указывать **атрибут** **name**).

Теперь когда наши данные уйдут на **сервер** нам необходимо эти данные оправить с помощью **метода** **send(formData)** и вот здесь у нас уже есть **body**, потому что мы что-то отправляем, не сложно догадаться, что это **объект** **formData**, который мы сформировали на основании **form**, которая была заполнена.

Далее на **request** навешиваем **обработчик события** и говорим, что мы отслеживаем **событие** **load** (конечную загрузку нашего **запроса**). И внутри с помощью **условия** проверяем **request.status === 200** - это значит, что ели **запрос** успешно прошел, то мы выводим в консоль ответ от **сервера** **console.log(request.response)**.

Кроме того мы создаем внутри **функции** элемент **div** с помощью **метода** **createElement()** и с помощью **метода append()** помещаем его на страницу.

И также с помощью **textContent** мы помещаем текстовые сообщения:

- внутри **функции** **postData()**: **statusMessage.textContent = message.loading**
- в **условии**, когда запрос выполнился **statusMessage.textContent = message.success**
- и в **else**, если **запрос** не выполнился: **statusMessage.textContent = message.failure**

Существует очень важный нюанс: когда мы используем связку **XMLHttpRequest() + formData**, заголовок **setRequestHeader** устанавливать не нужно, он устанавливается автоматически.

И еще напишем код, чтобы очистить нашу **форму** при успешной отправке, делаем это с помощью **метода** **reset()**. И еще делаем так, чтобы после истечения 2 секунд наш текстовый блок, наше сообщение очищалось:

**setTimeout(() => {**

**statusMessage.remove();**

**}, 2000);**

```JavaScript
const forms = document.querySelectorAll('form');

    const message = {
        loading: 'Загрузка',
        success: 'Спасибо! Скоро мы с вами свяжемся',
        failure: 'Что-то пошло не так...'
    };

    forms.forEach(item => {
        postData(item);
    });

    function postData(form) {
        form.addEventListener('submit', (e) => {
            e.preventDefault();

            const statusMessage = document.createElement('div');
            statusMessage.classList.add('status');
            statusMessage.textContent = message.loading;
            form.append(statusMessage);

            const request = new XMLHttpRequest();
            request.open('POST', 'server.php');

            // request.setRequestHeader('Content-type', 'multipart/form-data');
            const formData = new FormData(form);

            request.send(formData);

            request.addEventListener('load', () => {
                if(request.status === 200) {
                    console.log(request.response);
                    statusMessage.textContent = message.success;
                    form.reset();
                    setTimeout(() => {
                        statusMessage.remove();
                    }, 2000);
                } else {
                    statusMessage.textContent = message.failure;
                }
            });
        });
```

Теперь, если нам на **сервер** необходимо отправить данные в формате **JSON**.

Здесь нам уже понадобится **setRequestHeader()**. И чтобы перевести из **формата** **formData** в **JSON** мы используем вот такую конструкцию, чтобы получить обычный **объект** :

**const object = {};**

**formData.forEach(function(value, key){**

**object[key] = value;**

**});**

А после уже на обычном **объекте**, а не **formData** используем конвертацию в **JSON** с помощью **JSON.stringify()**

```JavaScript
request.setRequestHeader('Content-type', 'application/json');
const formData = new FormData(form);

const object = {};
formData.forEach(function(value, key){
    object[key] = value;
});

const json = JSON.stringify(object);

request.send(json);
```

![[Untitled 130.png|Untitled 130.png]]

![[Untitled 1 62.png|Untitled 1 62.png]]

  

![[Untitled 2 47.png|Untitled 2 47.png]]

![[Untitled 3 34.png|Untitled 3 34.png]]

server.php

**echo var_dump($_POST)** -  по простому эта команда на языке **php** берет те данные, которые нам пришли с клиента, превращает их в **строку** и непосредственно показывает обратно на клиенте, это как раз тот **response**, который нам будет приходить с **сервера**.

**$_POST = json_decode(file_get_contents("php://input"), true)** - это строчка кода на **php** коде получает **JSON** данные, чтобы с ними работать.

![[Untitled 4 25.png|Untitled 4 25.png]]

  

```HTML
<div class="order">
        <div class="container">
            <div class="title">Заказывай пробный день прямо сейчас!</div>
            <form action="#" class="order__form">
                <input required placeholder="Ваше имя" name="name" type="text" class="order__input">
                <input required placeholder="Ваш номер телефона" name="phone" type="phone" class="order__input">
                <img src="icons/right.svg" alt="right">
                <button class="btn btn_dark btn_min">Перезвонить мне</button>
            </form>
        </div>
    </div>
```

```HTML
<div class="modal">
        <div class="modal__dialog">
            <div class="modal__content">
                <form action="#">
                    <div data-close class="modal__close">&times;</div>
                    <div class="modal__title">Мы свяжемся с вами как можно быстрее!</div>
                    <input required placeholder="Ваше имя" name="name" type="text" class="modal__input">
                    <input required placeholder="Ваш номер телефона" name="phone" type="phone" class="modal__input">
                    <button class="btn btn_dark btn_min">Перезвонить мне</button>
                </form>
            </div>
        </div>
    </div>
```